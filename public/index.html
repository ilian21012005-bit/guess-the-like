<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoLiked</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='%23e8a0b8'/><path fill='%23fff' d='M16 10.5l1.4 2.8 3.1.5-2.2 2.2.5 3.1-2.8-1.5-2.8 1.5.5-3.1-2.2-2.2 3.1-.5z'/><path fill='%23fff' opacity='.9' d='M12 22l2-6 2 6 2-6 2 6' stroke='%23fff' stroke-width='.5' fill='none'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/style.css" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0d0d0d" />
</head>
<body>
  <div id="reconnect-banner" class="reconnect-banner hidden">Reconnexion en cours‚Ä¶</div>
  <div id="app">
    <!-- √âcran d'accueil -->
    <section id="screen-home" class="screen">
      <h1>WhoLiked</h1>
      <p class="subtitle">Devine qui a lik√© ce TikTok</p>
      <div class="card">
        <label>Pseudo</label>
        <input type="text" id="input-username" placeholder="Ton pseudo" maxlength="50" />
        <label>Photo de profil (optionnel)</label>
        <div class="avatar-pick">
          <input type="url" id="input-avatar" placeholder="https://... ou choisis une image" />
          <label class="btn-avatar-file"><input type="file" id="input-avatar-file" accept="image/*" hidden /> Choisir une image</label>
        </div>
        <img id="avatar-preview" class="avatar-preview hidden" src="" alt="Aper√ßu" />
        <label>@ TikTok (optionnel)</label>
        <input type="text" id="input-tiktok" placeholder="@ton_compte" maxlength="50" />
        <div class="buttons">
          <button id="btn-create">Cr√©er une partie</button>
          <hr />
          <label>Rejoindre avec le code</label>
          <input type="text" id="input-code" placeholder="ABC123" maxlength="8" class="code-input" />
          <button id="btn-join">Rejoindre</button>
        </div>
      </div>
      <p id="home-error" class="error"></p>
      <p class="hint">Sur un h√©bergement gratuit, le serveur peut mettre ~1 min √† d√©marrer. Si ton ami ne peut pas rejoindre, assure-toi qu‚Äôil ouvre le lien juste apr√®s que tu aies cr√©√© la partie.</p>
    </section>

    <!-- Lobby -->
    <section id="screen-lobby" class="screen hidden">
      <h2>Salon <span id="lobby-code"></span> <button type="button" id="btn-copy-code" class="btn-copy-code" title="Copier le code">üìã Copier</button></h2>
      <p class="instruction instruction-summary">
        TikTok ‚Üí Console (F12) ‚Üí copie le script ‚Üí colle ici et importe.
        <button type="button" id="btn-toggle-steps" class="link-btn" aria-expanded="false">Voir le d√©tail</button>
      </p>
      <div class="steps-box">
        <p class="steps-title">R√©cup√©rer mes likes (3 √©tapes)</p>
        <div class="steps-detail" id="steps-detail" hidden>
          <ol class="steps-list">
            <li>Ouvre <a href="https://www.tiktok.com" target="_blank" rel="noopener">TikTok</a>, va sur <strong>ton profil</strong> puis l‚Äôonglet <strong>J‚Äôaime</strong>. D√©roule la page pour charger des vid√©os.</li>
          <li>Sur la page TikTok, appuie sur <strong>F12</strong> (ou clic droit ‚Üí Inspecter), onglet <strong>Console</strong>. Clique sur <strong>¬´ Copier le script ¬ª</strong> ci-dessous, puis dans la console : <strong>Ctrl+V</strong> et <strong>Entr√©e</strong>. Une alerte indiquera combien de liens ont √©t√© copi√©s.</li>
          <li>Reviens ici, <strong>colle</strong> (Ctrl+V) dans la zone ci-dessous et clique <strong>Importer</strong>.</li>
          </ol>
        </div>
        <button type="button" id="btn-copy-script">Copier le script</button>
        <p id="copy-script-feedback" class="copy-feedback hidden"></p>
        <label for="import-links" class="import-label">Colle ici les liens (Ctrl+V) puis clique Importer :</label>
        <textarea id="import-links" placeholder="Colle les liens copi√©s depuis TikTok‚Ä¶" rows="5"></textarea>
        <button id="btn-import-links">Importer</button>
      </div>
      <ul id="lobby-players"></ul>
      <div class="lobby-options host-only" id="lobby-options">
        <label>Nombre de manches</label>
        <select id="select-rounds">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50" selected>50</option>
        </select>
      </div>
      <p id="lobby-status" class="status"></p>
      <button id="btn-start" class="host-only hidden">Lancer la partie</button>
      <p id="lobby-error" class="error"></p>
    </section>

    <!-- Pr√©chargement des vid√©os -->
    <section id="screen-preload" class="screen hidden">
      <p id="preload-title" class="preload-title">Pr√©paration des vid√©os‚Ä¶</p>
      <p id="preload-progress" class="preload-progress" aria-live="polite" aria-atomic="true">0 / 0</p>
      <p id="preload-background-msg" class="preload-background-msg hidden">La partie va commencer, les vid√©os continuent de charger en arri√®re-plan.</p>
      <div class="preload-bar-wrap">
        <div id="preload-bar" class="preload-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="50" aria-label="Vid√©os pr√©charg√©es" style="width: 0%"></div>
      </div>
    </section>

    <!-- Jeu : d√©compte -->
    <section id="screen-countdown" class="screen hidden">
      <div id="countdown-number">3</div>
    </section>

    <!-- Jeu : vid√©o + vote -->
    <section id="screen-game" class="screen hidden">
      <div class="round-info round-badge">Round <span id="round-num">1</span> / <span id="round-total">50</span></div>
      <div id="video-container">
        <p id="video-loading" class="video-loading hidden">Extraction de la vid√©o en cours‚Ä¶</p>
        <video id="tiktok-video" class="native-video" playsinline loop muted autoplay preload="auto" referrerpolicy="no-referrer" controlslist="nodownload noplaybackrate"></video>
        <div class="volume-control" id="volume-control">
          <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100" title="Volume" aria-label="Volume" />
          <button type="button" id="btn-volume" class="btn-volume" title="Son on/off" aria-label="Volume">üîá</button>
        </div>
        <div class="video-crop video-fallback-embed">
          <iframe id="tiktok-embed" title="TikTok"></iframe>
        </div>
        <a id="video-open-tiktok" href="#" target="_blank" rel="noopener" class="video-fallback btn-open-tiktok">Ouvrir sur TikTok</a>
      </div>
      <div id="vote-area" aria-live="polite" aria-atomic="true">
        <p id="wait-owner" class="hidden">C'est ton like ! Attends que les autres votent.</p>
        <p id="vote-owner-hint" class="vote-owner-hint hidden"></p>
        <p id="vote-feedback" class="vote-feedback hidden"></p>
        <div id="vote-buttons" class="hidden"></div>
      </div>
      <div class="scores-inline" id="scores-inline"></div>
      <p class="quit-game-wrap"><button type="button" id="btn-quit-game" class="btn-quit-game secondary">Quitter la partie</button></p>
    </section>

    <!-- R√©v√©lation (roulette) -->
    <section id="screen-reveal" class="screen hidden" aria-live="polite" aria-atomic="true">
      <p class="reveal-label">Qui a lik√© ?</p>
      <div id="roulette-container">
        <img id="roulette-avatar" src="" alt="" />
        <p id="roulette-name"></p>
      </div>
      <div id="reveal-scores"></div>
      <div id="reveal-next-area">
        <button type="button" id="btn-next-round" class="btn-next-round host-only hidden">Round suivant</button>
        <p id="reveal-wait-host" class="reveal-wait-host hidden">En attente de l'h√¥te pour le round suivant‚Ä¶</p>
        <p class="quit-game-wrap"><button type="button" id="btn-quit-game-reveal" class="btn-quit-game secondary">Quitter la partie</button></p>
      </div>
    </section>

    <!-- Fin de partie -->
    <section id="screen-gameover" class="screen hidden" aria-live="polite" aria-atomic="true">
      <h2>Podium</h2>
      <div id="gameover-stats" class="gameover-stats"></div>
      <ol id="podium-list"></ol>
      <div class="gameover-actions">
        <button id="btn-share-score" class="secondary">Partager mon score</button>
        <button id="btn-replay">Rejouer</button>
        <button id="btn-lobby">Retour au lobby</button>
      </div>
    </section>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/app.js"></script>
</body>
</html>
